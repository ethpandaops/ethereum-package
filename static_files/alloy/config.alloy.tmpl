// Grafana Alloy configuration for Ethereum client profiling
// Auto-generated by ethereum-package

// ============================================================================
// pprof Scraping - Collects profiles from Go clients (Geth, Erigon, Prysm)
// ============================================================================

pyroscope.scrape "pprof_scrape" {
  targets = [
    {{.PProfTargets}}
  ]

  forward_to = [pyroscope.write.pyroscope.receiver]

  profiling_config {
    profile.process_cpu {
      enabled = true
    }
    profile.memory {
      enabled = true
    }
    profile.goroutine {
      enabled = true
    }
    profile.mutex {
      enabled = true
    }
    profile.block {
      enabled = true
    }
    // fgprof disabled - not all Go clients support it (only Erigon has it)
    profile.fgprof {
      enabled = false
    }
  }

  // Scrape interval - balance between coverage and overhead
  scrape_interval = "15s"
  scrape_timeout  = "10s"
}

// ============================================================================
// Pyroscope Write - Push profiles to Pyroscope server
// ============================================================================

pyroscope.write "pyroscope" {
  endpoint {
    url = "{{.PyroscopeURL}}"
  }
}

// ============================================================================
// Logging configuration
// ============================================================================

logging {
  level  = "info"
  format = "logfmt"
}
